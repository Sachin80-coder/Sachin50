<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Service - FixFinder</title>
</head>
<body style="margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); min-height: 100vh;">

<header style="background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <div style="max-width: 1200px; margin: 0 auto; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 10px; cursor: pointer;" onclick="window.location.href='{% url 'index' %}'">
            <div style="width: 40px; height: 40px; background: #3B82F6; color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold;">F</div>
            <span style="font-size: 1.5rem; font-weight: bold; color: #3B82F6;">FixFinder</span>
        </div>
        
        <nav style="display: flex; gap: 30px; align-items: center;">
            <a href="{% url 'index' %}"  style="text-decoration: none; color: #64748b; font-weight: 500; transition: color 0.3s;" 
               onmouseover="this.style.color='#3B82F6'" onmouseout="this.style.color='#64748b'">Home</a>
            <a href="{% url 'services' %}" style="text-decoration: none; color: #64748b; font-weight: 500; transition: color 0.3s;" 
               onmouseover="this.style.color='#3B82F6'" onmouseout="this.style.color='#64748b'">Services</a>
            <a href="{% url 'add_service' %}" style="text-decoration: none; color: #3B82F6; font-weight: 500;">Add Service</a>
        </nav>

        <div style="position: relative;">
            {% if user.is_authenticated %}
            <button onclick="toggleUserMenu()" style="background: #f1f5f9; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                <span>{{ user.first_name }}</span>
                <span style="font-size: 12px;">‚ñº</span>
            </button>
            <div id="dropdown-menu" style="display: none; position: absolute; right: 0; top: 100%; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 150px; z-index: 1001;">
                <a href="{% url 'dashboard' %}" style="display: block; padding: 12px 16px; text-decoration: none; color: #64748b;" 
                   onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">Dashboard</a>
                <a href="{% url 'profile' %}" style="display: block; padding: 12px 16px; text-decoration: none; color: #64748b;" 
                   onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">Profile</a>
                <a href="{% url 'logout' %}" style="display: block; padding: 12px 16px; text-decoration: none; color: #dc2626;" 
                   onmouseover="this.style.background='#fef2f2'" onmouseout="this.style.background='white'">Logout</a>
            </div>
            {% else %}
            <a href="{% url 'login' %}" style="text-decoration: none; color: #3B82F6; font-weight: 500; padding: 8px 16px;">Login</a>
            {% endif %}
        </div>
    </div>
</header>

<main style="padding: 40px 20px;">
    <div style="max-width: 800px; margin: 0 auto;">
        <div style="text-align: center; margin-bottom: 40px;">
            <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 15px; color: #1f2937;">Add Your Service</h1>
            <p style="font-size: 1.1rem; color: #6b7280; line-height: 1.6;">List your professional service and connect with customers in your area</p>
        </div>

        <div style="background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1);">
           <form method="post" action="{% url 'add_service' %}" id="service-form" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- Messages -->
                {% if messages %}
                <div style="margin-bottom: 20px;">
                    {% for message in messages %}
                        {% if message.tags == 'error' %}
                        <div style="background: #fee2e2; color: #dc2626; padding: 12px; border-radius: 8px; border: 1px solid #fca5a5; text-align: center; margin-bottom: 10px;">
                            {{ message }}
                        </div>
                        {% else %}
                        <div style="background: #d1fae5; color: #065f46; padding: 12px; border-radius: 8px; border: 1px solid #a7f3d0; text-align: center; margin-bottom: 10px;">
                            {{ message }}
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}

               <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #374151; font-size: 1.1rem;">Service Category *</label>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                        {% for category in categories %}
                        <button type="button"
                                onclick="selectCategory('{{ category.id }}')"
                                id="cat-{{ category.id }}"
                                style="padding: 12px; border: 2px solid #e5e7eb; background: white; color: #6b7280; border-radius: 8px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.95rem;">
                            <span>{{ category.icon }}</span> {{ category.name }}
                        </button>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="category" id="category-input" required>
                    <div id="category-error" style="color: #dc2626; font-size: 0.9rem; margin-top: 5px; display: none;">Please select a category</div>
                </div>

                <div style="margin-bottom: 25px;">
                    <label for="title" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 1.1rem;">Service Title *</label>
                    <input type="text" id="title" name="title" required 
                           style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: all 0.3s; outline: none; box-sizing: border-box;"
                           placeholder="Brief title for your service (e.g., 'Professional Plumbing Services')"
                           onfocus="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" 
                           onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'">
                </div>

                <div style="margin-bottom: 25px;">
                    <label for="description" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 1.1rem;">Service Description *</label>
                    <textarea id="description" name="description" required rows="4"
                              style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: all 0.3s; outline: none; resize: vertical; box-sizing: border-box; font-family: inherit;"
                              placeholder="Describe your service in detail, including what's included, your expertise, and any special features..."
                              onfocus="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" 
                              onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div>
                        <label for="price" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 1.1rem;">Price Range *</label>
                        <select id="price" name="price" required 
                                style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; outline: none; cursor: pointer; box-sizing: border-box;"
                                onfocus="this.style.borderColor='#3B82F6'" onblur="this.style.borderColor='#e5e7eb'">
                            <option value="">Select price range</option>
                            <option value="‚Çπ200-500">‚Çπ200-500</option>
                            <option value="‚Çπ500-1000">‚Çπ500-1000</option>
                            <option value="‚Çπ1000-2000">‚Çπ1000-2000</option>
                            <option value="‚Çπ2000-5000">‚Çπ2000-5000</option>
                            <option value="‚Çπ5000+">‚Çπ5000+</option>
                            <option value="Custom Quote">Custom Quote</option>
                        </select>
                    </div>
                    <div>
                        <label for="location" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 1.1rem;">Service Location *</label>
                        <div style="position: relative;">
                            <input type="text" id="location" name="location" required 
                                   style="width: 100%; padding: 14px 40px 14px 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: all 0.3s; outline: none; box-sizing: border-box;"
                                   placeholder="Your service area" value="{{ user.location }}"
                                   onfocus="this.style.borderColor='#3B82F6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" 
                                   onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'">
                            <button type="button" onclick="getCurrentLocation()" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: #3B82F6; color: white; border: none; padding: 6px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;" title="Get Current Location">üìç</button>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <div>
                        <label for="experience" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 1.1rem;">Experience *</label>
                        <select id="experience" name="experience" required 
                                style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; outline: none; cursor: pointer; box-sizing: border-box;"
                                onfocus="this.style.borderColor='#3B82F6'" onblur="this.style.borderColor='#e5e7eb'">
                            <option value="">Select experience</option>
                            <option value="0-1 years">0-1 years</option>
                            <option value="1-3 years">1-3 years</option>
                            <option value="3-5 years">3-5 years</option>
                            <option value="5-10 years">5-10 years</option>
                            <option value="10+ years">10+ years</option>
                        </select>
                    </div>
                    <div>
                        <label for="availability" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 1.1rem;">Availability *</label>
                        <select id="availability" name="availability" required 
                                style="width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; outline: none; cursor: pointer; box-sizing: border-box;"
                                onfocus="this.style.borderColor='#3B82F6'" onblur="this.style.borderColor='#e5e7eb'">
                            <option value="">Select availability</option>
                            <option value="Available Now">Available Now</option>
                            <option value="Busy (1-2 days)">Busy (1-2 days)</option>
                            <option value="Booked (3+ days)">Booked (3+ days)</option>
                        </select>
                    </div>
                </div>

                <div style="margin-bottom: 25px;">
                    <label for="service-images" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151; font-size: 1.1rem;">Service Images (Optional)</label>
                    <div style="border: 2px dashed #e5e7eb; border-radius: 8px; padding: 30px; text-align: center; transition: all 0.3s;"
                         onmouseover="this.style.borderColor='#3B82F6'; this.style.background='#f8fafc'" 
                         onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'"
                         ondragover="handleDragOver(event)" 
                         ondrop="handleDrop(event)">
                        <input type="file" id="images" name="images" accept=".jpg,.jpeg,.png" multiple 
                               style="display: none;" onchange="handleFileSelect(event)">
                        <div style="font-size: 3rem; margin-bottom: 15px; color: #6b7280;">üì∏</div>
                        <p style="color: #6b7280; margin-bottom: 15px; font-size: 1.1rem;">Drag & drop images here or click to browse</p>
                        <button type="button" onclick="document.getElementById('images').click()" 
                                style="background: #3B82F6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 500;">
                            Choose Images
                        </button>
                        <p style="color: #9ca3af; font-size: 0.9rem; margin-top: 10px;">JPG, PNG up to 5MB each (Max 5 images)</p>
                    </div>
                    <div id="image-preview" style="display: none; margin-top: 15px;">
                        <p style="font-weight: 500; color: #374151; margin-bottom: 10px;">Selected Images:</p>
                        <div id="preview-container" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button type="submit" onclick="return validateForm()"
                            style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 16px 40px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; min-width: 200px;"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(16, 185, 129, 0.3)'" 
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        Add Service
                    </button>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <p style="color: #6b7280; font-size: 0.9rem; line-height: 1.5;">
                        By adding a service, you agree to provide quality work and maintain professional standards. Your service will be visible to customers immediately.
                    </p>
                </div>
            </form>
        </div>
    </div>
</main>

<script>
    let selectedCategory = '';
    let selectedFiles = [];

    function selectCategory(categoryId) {
        selectedCategory = categoryId;
        document.getElementById('category-input').value = categoryId;
        document.getElementById('category-error').style.display = 'none';
        
        document.querySelectorAll('[id^="cat-"]').forEach(btn => {
            btn.style.background = 'white';
            btn.style.color = '#6b7280';
            btn.style.borderColor = '#e5e7eb';
        });
        
        const selectedBtn = document.getElementById(`cat-${categoryId}`);
        selectedBtn.style.background = '#eff6ff';
        selectedBtn.style.color = '#1d4ed8';
        selectedBtn.style.borderColor = '#3B82F6';
    }

    function validateForm() {
        if (!selectedCategory) {
            document.getElementById('category-error').style.display = 'block';
            return false;
        }
        return true;
    }

    function getCurrentLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                
                // Use reverse geocoding to get address (simplified version)
                fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.city) {
                            document.getElementById('location').value = `${data.city}, ${data.countryName}`;
                        } else {
                            document.getElementById('location').value = `Lat: ${lat.toFixed(4)}, Lon: ${lon.toFixed(4)}`;
                        }
                    })
                    .catch(() => {
                        document.getElementById('location').value = `Lat: ${lat.toFixed(4)}, Lon: ${lon.toFixed(4)}`;
                    });
            }, function(error) {
                alert('Location access denied or not available.');
            });
        } else {
            alert('Geolocation is not supported by this browser.');
        }
    }

    // File handling functions
    function handleDragOver(event) {
        event.preventDefault();
        event.currentTarget.style.borderColor = '#3B82F6';
        event.currentTarget.style.background = '#f8fafc';
    }

    function handleDrop(event) {
        event.preventDefault();
        event.currentTarget.style.borderColor = '#e5e7eb';
        event.currentTarget.style.background = 'white';
        const files = Array.from(event.dataTransfer.files);
        handleFiles(files);
    }

    function handleFileSelect(event) {
        const files = Array.from(event.target.files);
        handleFiles(files);
    }

    function handleFiles(files) {
        const validFiles = files.filter(file => {
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
            const maxSize = 5 * 1024 * 1024; // 5MB
            
            if (!validTypes.includes(file.type)) {
                alert('Only JPG, JPEG, PNG files are allowed.');
                return false;
            }
            if (file.size > maxSize) {
                alert('File size should be less than 5MB.');
                return false;
            }
            return true;
        });
        
        if (selectedFiles.length + validFiles.length > 5) {
            alert('Maximum 5 images allowed.');
            return;
        }
        
        selectedFiles = [...selectedFiles, ...validFiles];
        updateImagePreview();
        
        // Update file input
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => dataTransfer.items.add(file));
        document.getElementById('images').files = dataTransfer.files;
    }

    function updateImagePreview() {
        const previewDiv = document.getElementById('image-preview');
        const container = document.getElementById('preview-container');
        
        if (selectedFiles.length === 0) {
            previewDiv.style.display = 'none';
            return;
        }
        
        previewDiv.style.display = 'block';
        container.innerHTML = '';
        
        selectedFiles.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageDiv = document.createElement('div');
                imageDiv.style.cssText = 'position: relative; display: inline-block;';
                imageDiv.innerHTML = `
                    <img src="${e.target.result}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb;">
                    <button type="button" onclick="removeImage(${index})" style="position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center;">√ó</button>
                `;
                container.appendChild(imageDiv);
            };
            reader.readAsDataURL(file);
        });
    }

    function removeImage(index) {
        selectedFiles.splice(index, 1);
        updateImagePreview();
        
        // Update file input
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => dataTransfer.items.add(file));
        document.getElementById('images').files = dataTransfer.files;
    }

    function toggleUserMenu() {
        const dropdown = document.getElementById('dropdown-menu');
        dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('dropdown-menu');
        if (dropdown && !event.target.closest('button')) {
            dropdown.style.display = 'none';
        }
    });
</script>

</body>
</html>